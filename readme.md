FluidNet: 2D Viscous Flow Simulation Using CNN
This project leverages a Convolutional Neural Network (CNN) to simulate 2D viscous flow, with the target being the lattice Boltzmann algorithm (LBA). It demonstrates how deep learning can be applied to simulate complex fluid dynamics processes by learning from data generated by a lattice Boltzmann solver.

Overview
Objective: Train a CNN model (FluidNet) to predict the flow field of a 2D viscous fluid.
Dataset: The dataset is generated using a custom GenerateFlowData class, which creates samples of fluid flow data using a Lattice Boltzmann method.
Model: The FluidNet model takes flow data as input and predicts fluid properties such as velocity and density at each timestep.
Loss Function: Mean Squared Error (MSE) loss with masking to ignore regions with very small velocities.
Training: The model is trained using the Adam optimizer and early stopping based on validation loss.
Visualization: After training, the model's predictions are animated as GIFs for visual inspection.
Requirements
Python 3.7 or higher
PyTorch
NumPy
Matplotlib
TorchSummary
PIL (for image handling)
OpenCV (for animation)
Matplotlib for visualization
To install the dependencies, use the following command:

bash
Copy
Edit
pip install torch numpy matplotlib Pillow opencv-python
Project Structure
plaintext
Copy
Edit
├── animate.py               # Functions to animate fluid flow simulation results
├── generate_data.py         # Generates training data using Lattice Boltzmann Method
├── models.py                # FluidNet model definition
├── train.py                 # Main training script for FluidNet
├── flow_animationX.gif      # Example of generated flow animations (GIFs)
├── fluid_model.pth          # Saved model after training
└── README.md                # Project documentation
Usage
Step 1: Generate the Flow Data
You can generate the training and validation datasets using the GenerateFlowData class. It randomly generates flow data (velocity, density) based on user-defined parameters like box size, viscosity, and speed range.

python
Copy
Edit
from generate_data import GenerateFlowData

gfd = GenerateFlowData(
    box=(40, 80),  # Grid dimensions (height, width)
    velocity_range=(0.08, 0.12),  # Range for velocity magnitude
    viscosity_range=(0.004, 0.02),  # Range for viscosity
    use_curl=True,  # If True, use curl-based representation for output
    num_timeframes=100,  # Number of timesteps per simulation
    num_samples=256,  # Total number of samples
)

X, Y = gfd.get_dataset()  # Get the dataset
Step 2: Training the Model
Once the data is generated, you can train the CNN model to simulate fluid dynamics. The training script takes the generated dataset, initializes the model, and performs training using the Adam optimizer with MSE loss.

Run the following script to start training:

bash
Copy
Edit
python train.py
The model will train for the specified number of epochs (default: 50) and will utilize early stopping if there is no improvement in validation loss for a certain number of epochs (default: 4). The model weights are saved in fluid_model.pth.

Step 3: Visualization of Results
After training, you can visualize the model's output using animations. This step will generate flow animations (GIFs) that compare the model's predicted flow field to the ground truth from the Lattice Boltzmann method.

python
Copy
Edit
from animate import animate_flow

# Load the trained model
model.load_state_dict(torch.load("fluid_model.pth"))
model.eval()

# Generate and save animations
for i in range(12):  # Generate 12 GIFs
    animate_flow(
        ground_truth_data,  # Ground truth flow data
        model_predictions,  # Model predicted flow data
        barrier_data,       # Barrier data
        output_gif_path=f"flow_animation{i}.gif"  # Save animation
    )
Step 4: Model Saving and Loading
You can save and load your trained model as follows:

python
Copy
Edit
# Save the model
torch.save(model.state_dict(), "fluid_model.pth")

# Load the model
model.load_state_dict(torch.load("fluid_model.pth"))
Model Architecture
FluidNet is a CNN model designed to predict fluid dynamics data. It uses convolutional layers to process the fluid data, followed by a series of fully connected layers to output the predicted velocity or curl field.

Input:
4 or 5 channels, depending on whether the curl representation is used:
Barrier
Viscosity
Velocity magnitude
Velocity components (if not using curl)
Output:
1 channel (if curl is used) or 2 channels (velocity components, if not using curl)
Early Stopping
The training process uses early stopping, where training will halt if no improvement in validation loss is seen for a specified number of epochs (default: 4). This helps avoid overfitting and reduces unnecessary computation.

Visualizing the Results
After training, the flow animations can be generated by comparing the model's output with the ground truth. This provides an intuitive way to assess the model's performance.

Example Outputs
After training, you will find the following files in the directory:

fluid_model.pth: The trained model's weights.
flow_animationX.gif: A series of GIFs showing the model's predictions at different time steps.
Notes
The flow data is normalized for training to improve model convergence.
The Lattice Boltzmann method is used to generate realistic flow data, and the model is trained to replicate this simulation.
References
Lattice Boltzmann Method: For simulating fluid dynamics.
Deep Learning for Fluid Simulation: This project demonstrates how deep learning can learn to simulate complex fluid behavior.
